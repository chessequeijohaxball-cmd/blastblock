<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Blast Block</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#0b1220;
  color:white;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1{margin:15px}
#menu,#overlay{
  position:fixed;
  inset:0;
  background:#0b1220;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
button{
  padding:14px 35px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:#3cff78;
  margin:10px;
}
#game{
  display:grid;
  grid-template-columns:repeat(8,42px);
  gap:4px;
  background:#05080f;
  padding:10px;
  border-radius:14px;
}
.cell{
  width:42px;
  height:42px;
  background:#111;
  border-radius:6px;
}
.filled{background:#3cff78}
#pieces{
  display:flex;
  gap:20px;
  margin:20px;
}
.piece{display:grid;gap:4px;touch-action:none}
.block{width:30px;height:30px;background:#3cff78;border-radius:6px}
</style>
</head>

<body>

<div id="menu">
  <h1>Blast Block</h1>
  <button onclick="startGame()">â–¶ Play</button>
  <button onclick="toggleSound()">ðŸ”Š Som: <span id="soundTxt">ON</span></button>
</div>

<p>PontuaÃ§Ã£o: <span id="score">0</span></p>
<div id="game"></div>
<div id="pieces"></div>

<div id="overlay" style="display:none">
  <h2>Fim de Jogo</h2>
  <p>Sua pontuaÃ§Ã£o: <span id="finalScore"></span></p>
  <button onclick="startGame()">Play</button>
</div>

<!-- SONS -->
<audio id="sndPlace" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="sndClear" src="https://assets.mixkit.co/active_storage/sfx/2707/2707-preview.mp3"></audio>
<audio id="sndLose"  src="https://assets.mixkit.co/active_storage/sfx/1103/1103-preview.mp3"></audio>

<script>
const GRID=8
let board=[],score=0,sound=true

const shapes=[
 [[1,1,1]],
 [[1],[1],[1]],
 [[1,1],[1,1]],
 [[1]]
]

const game=document.getElementById("game")
const piecesDiv=document.getElementById("pieces")

function toggleSound(){
  sound=!sound
  document.getElementById("soundTxt").innerText=sound?"ON":"OFF"
}

function play(id){
  if(sound) document.getElementById(id).play()
}

function startGame(){
  document.getElementById("menu").style.display="none"
  document.getElementById("overlay").style.display="none"
  board=Array.from({length:GRID},()=>Array(GRID).fill(0))
  score=0
  document.getElementById("score").innerText=score
  drawBoard()
  newPieces()
}

function drawBoard(){
  game.innerHTML=""
  for(let y=0;y<GRID;y++)
    for(let x=0;x<GRID;x++){
      const d=document.createElement("div")
      d.className="cell"+(board[y][x]?" filled":"")
      game.appendChild(d)
    }
}

function newPieces(){
  piecesDiv.innerHTML=""
  for(let i=0;i<3;i++){
    const s=shapes[Math.floor(Math.random()*shapes.length)]
    const p=document.createElement("div")
    p.className="piece"
    p.shape=s
    p.style.gridTemplateColumns=`repeat(${s[0].length},30px)`
    s.forEach(r=>r.forEach(v=>{
      const b=document.createElement("div")
      b.className=v?"block":""
      p.appendChild(b)
    }))
    drag(p)
    piecesDiv.appendChild(p)
  }
}

function drag(p){
  let ox,oy
  p.onpointerdown=e=>{
    ox=e.clientX;oy=e.clientY
    p.setPointerCapture(e.pointerId)
  }
  p.onpointermove=e=>{
    p.style.transform=`translate(${e.clientX-ox}px,${e.clientY-oy}px)`
  }
  p.onpointerup=e=>{
    p.style.transform=""
    drop(p,e.clientX,e.clientY)
  }
}

function drop(p,x,y){
  const r=game.getBoundingClientRect()
  const gx=Math.floor((x-r.left)/46)
  const gy=Math.floor((y-r.top)/46)
  if(can(p.shape,gx,gy)){
    place(p.shape,gx,gy)
    play("sndPlace")
    p.remove()
    clear()
    if(!piecesDiv.children.length) newPieces()
    if(!hasMoves()) gameOver()
  }
}

function can(s,x,y){
  for(let r=0;r<s.length;r++)
    for(let c=0;c<s[r].length;c++)
      if(s[r][c] && (!board[y+r]||board[y+r][x+c])) return false
  return true
}

function place(s,x,y){
  s.forEach((r,ry)=>r.forEach((v,rx)=>{if(v) board[y+ry][x+rx]=1}))
  score+=10
  document.getElementById("score").innerText=score
  drawBoard()
}

function clear(){
  for(let y=0;y<GRID;y++)
    if(board[y].every(v=>v)){
      board[y].fill(0)
      score+=100
      play("sndClear")
    }
}

function hasMoves(){
  for(const p of piecesDiv.children)
    for(let y=0;y<GRID;y++)
      for(let x=0;x<GRID;x++)
        if(can(p.shape,x,y)) return true
  return false
}

function gameOver(){
  play("sndLose")
  document.getElementById("finalScore").innerText=score
  document.getElementById("overlay").style.display="flex"
}
</script>
</body>
</html>
